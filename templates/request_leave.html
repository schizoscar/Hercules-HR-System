{% extends "base.html" %}

{% block title %}{% if editing %}Edit Leave{% elif admin_editing %}Edit Leave (Admin){% else %}Request Leave{% endif %}{% endblock %}

{% block header %}{% if editing %}Edit Leave{% elif admin_editing %}Edit Leave (Admin){% else %}Request Leave{% endif %}{% endblock %}

{% block content %}
<div style="max-width: 600px; margin: 0 auto;">
    <h2>{% if editing %}Edit Leave Request{% elif admin_editing %}Edit Leave Request (Admin){% else %}Request Leave{% endif %}</h2>
    <!-- Add enctype="multipart/form-data" to handle file uploads -->
    <form method="POST" enctype="multipart/form-data">
        {{ form.hidden_tag() }}
        
        <div style="margin-bottom: 15px;">
            <label for="start_date" style="display: block; margin-bottom: 5px;">Start Date</label>
            {{ form.start_date(class="form-control", style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;", type="date") }}
            {% if form.start_date.errors %}
                <div style="color: red; font-size: 0.9rem; margin-top: 5px;">
                    {% for error in form.start_date.errors %}
                        {{ error }}
                    {% endfor %}
                </div>
            {% endif %}
        </div>
        
        <div style="margin-bottom: 15px;">
            <label for="end_date" style="display: block; margin-bottom: 5px;">End Date</label>
            {{ form.end_date(class="form-control", style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;", type="date") }}
            {% if form.end_date.errors %}
                <div style="color: red; font-size: 0.9rem; margin-top: 5px;">
                    {% for error in form.end_date.errors %}
                        {{ error }}
                    {% endfor %}
                </div>
            {% endif %}
        </div>
        
        <div style="margin-bottom: 15px;">
            <label for="leave_type" style="display: block; margin-bottom: 5px;">Leave Type</label>
            {{ form.leave_type(class="form-control", style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;", id="leave_type_select") }}
            {% if form.leave_type.errors %}
                <div style="color: red; font-size: 0.9rem; margin-top: 5px;">
                    {% for error in form.leave_type.errors %}
                        {{ error }}
                    {% endfor %}
                </div>
            {% endif %}
        </div>
        
        <!-- Compassionate Type Field (initially hidden) -->
        <div id="compassionate_type_container" style="margin-bottom: 15px; display: none;">
            <label for="compassionate_type" style="display: block; margin-bottom: 5px;">Compassionate Leave Type</label>
            {{ form.compassionate_type(class="form-control", style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;") }}
            {% if form.compassionate_type.errors %}
                <div style="color: red; font-size: 0.9rem; margin-top: 5px;">
                    {% for error in form.compassionate_type.errors %}
                        {{ error }}
                    {% endfor %}
                </div>
            {% endif %}
        </div>
        
        <div style="margin-bottom: 15px;">
            <label for="reason" style="display: block; margin-bottom: 5px;">Reason</label>
            {{ form.reason(class="form-control", style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; min-height: 100px;", placeholder="Please provide a reason for your leave request") }}
            {% if form.reason.errors %}
                <div style="color: red; font-size: 0.9rem; margin-top: 5px;">
                    {% for error in form.reason.errors %}
                        {{ error }}
                    {% endfor %}
                </div>
            {% endif %}
        </div>

        <!-- Add file upload field -->
        <div style="margin-bottom: 15px;">
            <label for="attachment" style="display: block; margin-bottom: 5px;">Attachment (if any)</label>
            {{ form.attachment(class="form-control", style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;") }}
            {% if form.attachment.errors %}
                <div style="color: red; font-size: 0.9rem; margin-top: 5px;">
                    {% for error in form.attachment.errors %}
                        {{ error }}
                    {% endfor %}
                </div>
            {% endif %}
        </div>
        
        <div style="text-align: center;">
            {% if admin_editing %}
                <button type="submit" class="btn" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 12px 24px; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); height: 44px;">
                    Confirm Changes
                </button>
            {% else %}
                {{ form.submit(class="btn", style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 12px 24px; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); height: 44px;") }}
            {% endif %}
            <a href="{% if admin_editing %}{{ url_for('all_leaves') }}{% else %}{{ url_for('leaves') }}{% endif %}" style="background: linear-gradient(135deg, #6c757d 0%, #495057 100%); color: white; padding: 12px 24px; border: none; border-radius: 6px; text-decoration: none; display: inline-block; margin-left: 10px; font-weight: 600; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); height: 44px; line-height: 20px;">Cancel</a>
        </div>
    </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('start_date').setAttribute('min', today);
        document.getElementById('end_date').setAttribute('min', today);

        // Update end date min when start date changes
        document.getElementById('start_date').addEventListener('change', function () {
            document.getElementById('end_date').setAttribute('min', this.value);
        });

        // Show/hide compassionate type based on leave type selection
        const leaveTypeSelect = document.getElementById('leave_type_select');
        const compassionateContainer = document.getElementById('compassionate_type_container');

        function toggleCompassionateField() {
            if (leaveTypeSelect.value === 'compassionate') {
                compassionateContainer.style.display = 'block';
            } else {
                compassionateContainer.style.display = 'none';
            }
        }

        // Initial check
        toggleCompassionateField();

        // Add event listener for changes
        leaveTypeSelect.addEventListener('change', toggleCompassionateField);
    });
</script>

<style>
    .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
    }
    
    a[style*="background: linear-gradient"]:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        text-decoration: none;
    }
</style>
{% endblock %}