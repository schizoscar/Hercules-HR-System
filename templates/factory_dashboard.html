{% extends "base.html" %}

{% block title %}Factory Dashboard{% endblock %}

{% block header %}Factory Dashboard{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Welcome Section with Time Tracking -->
    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 30px; gap: 20px; flex-wrap: wrap;">
        <div class="welcome-section glass" style="flex: 1; padding: 25px; border-radius: var(--border-radius-lg); min-width: 300px;">
            <h2 style="margin-bottom: 10px; background: var(--gradient-primary); -webkit-background-clip: text; background-clip: text; color: transparent;">Welcome, {{ current_user.full_name }}!</h2>
            <p style="color: var(--gray); margin: 0;">Today is {{ now.strftime('%A, %B %d, %Y') }}</p>
        </div>
        
        <!-- Time Tracking Buttons (SAME AS REGULAR DASHBOARD) -->
        <div class="time-tracking-section glass" style="padding: 25px; border-radius: var(--border-radius-lg); min-width: 300px;">
            <h3 style="margin-bottom: 15px; color: var(--dark); text-align: center;">‚è∞ Time Tracking</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                <form id="timeTrackingForm" method="POST" action="{{ url_for('time_tracking') }}">
                    {{ form.hidden_tag() }}
                    {{ form.action_type(id="actionType") }}
                    {{ form.latitude(id="latitude") }}
                    {{ form.longitude(id="longitude") }}
                    {{ form.address(id="address") }}
                    
                    {% if not current_user.last_clock_in or current_user.last_clock_in.date() != now.date() %}
                    <button type="button" onclick="trackTime('clock_in')" 
                            style="background: var(--gradient-success); color: white; padding: 14px; border: none; border-radius: var(--border-radius); cursor: pointer; width: 100%; font-weight: 600; font-size: 1rem; display: flex; align-items: center; justify-content: center; gap: 8px;">
                        <span>üìÖ</span>
                        <span>Clock In</span>
                    </button>
                    {% else %}
                    <button type="button" onclick="trackTime('clock_out')" 
                            style="background: var(--gradient-danger); color: white; padding: 14px; border: none; border-radius: var(--border-radius); cursor: pointer; width: 100%; font-weight: 600; font-size: 1rem; display: flex; align-items: center; justify-content: center; gap: 8px;">
                        <span>üè†</span>
                        <span>Clock Out</span>
                    </button>
                    {% endif %}
                    
                    {% if current_user.last_clock_in and current_user.last_clock_in.date() == now.date() and (not current_user.last_lunch_start or current_user.last_lunch_start.date() != now.date()) %}
                    <button type="button" onclick="trackTime('lunch_start')" 
                            style="background: var(--gradient-warning); color: white; padding: 14px; border: none; border-radius: var(--border-radius); cursor: pointer; width: 100%; font-weight: 600; font-size: 1rem; display: flex; align-items: center; justify-content: center; gap: 8px;">
                        <span>üçΩÔ∏è</span>
                        <span>Start Lunch</span>
                    </button>
                    {% elif current_user.last_lunch_start and current_user.last_lunch_start.date() == now.date() and (not current_user.last_lunch_end or current_user.last_lunch_end.date() != now.date()) %}
                    <button type="button" onclick="trackTime('lunch_end')" 
                            style="background: var(--gradient-info); color: white; padding: 14px; border: none; border-radius: var(--border-radius); cursor: pointer; width: 100%; font-weight: 600; font-size: 1rem; display: flex; align-items: center; justify-content: center; gap: 8px;">
                        <span>‚è±Ô∏è</span>
                        <span>End Lunch</span>
                    </button>
                    {% else %}
                    <button type="button" disabled
                            style="background: var(--gray); color: white; padding: 14px; border: none; border-radius: var(--border-radius); cursor: not-allowed; width: 100%; font-weight: 600; font-size: 1rem; display: flex; align-items: center; justify-content: center; gap: 8px;">
                        <span>üçΩÔ∏è</span>
                        <span>Start Lunch</span>
                    </button>
                    {% endif %}
                </form>
            </div>
        </div>
    </div>

    <!-- Factory-specific content -->
    <div class="glass" style="padding: 25px; border-radius: var(--border-radius-lg);">
        <h3 style="margin-bottom: 20px;">Factory Worker Dashboard</h3>
        <p>This is your specialized factory worker dashboard. You can manage your leave requests and track your time here.</p>
        
        <div style="margin-top: 20px;">
            <a href="{{ url_for('leaves') }}" class="btn btn-primary" style="display: inline-block; margin-right: 10px;">
                üå¥ Manage Leaves
            </a>
            <a href="{{ url_for('time_reports') }}" class="btn btn-secondary" style="display: inline-block;">
                ‚è±Ô∏è View Time Reports
            </a>
        </div>
    </div>
</div>

<!-- Include the same JavaScript as regular dashboard -->
<script>
function trackTime(actionType) {
    // Same JavaScript as in dashboard.html
}
</script>
{% endblock %}